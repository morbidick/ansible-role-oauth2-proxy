---
- name: Test play
  hosts: all

  roles:
    - role_under_test

  pre_tasks:
    - name: Create test directory
      ansible.builtin.file:
        path: "{{ oauth2_test_dir }}"
        state: directory
        mode: '0755'

    - name: Create sample file
      ansible.builtin.copy:
        content: "This file should be viewable after authentication."
        dest: "{{ oauth2_test_dir }}/index.html"
        mode: '0644'

  vars:
    oauth2_test_dir: "/var/www"

    oauth2_proxy_config:
      http_address: "0.0.0.0:5000"
      upstreams: ["file://{{ oauth2_test_dir }}/#/"]
      provider: "github"
      email_domains: "*"
      cookie_secure: false
      cookie_domains: "localhost:5000"
      cookie_secret: "{{ 'COOK_SECRET' | b64encode }}"
      client_id: "YOUR_CLIENT_ID"
      client_secret: "CLIENT_SECERET"
